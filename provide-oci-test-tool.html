<html>
    <head>
        <script type="text/javascript">
		
			var CONST_VERSION = "Version 1.10 - Unescaped URI for HOOK_URL";
		
            function writeParameters(urlFullString) {
                
				var result = "";
				var url = urlFullString.split("?");
				if ( url.length < 2 ) {
					document.writeln("No parameters in URL: ");
					document.writeln(urlFullString);
					return result;
				} 
				var params = url[1].split("&");	
				document.writeln("<H1>" + CONST_VERSION + "</H1>");
				result = "<TABLE>";
                for ( i = 0; i < params.length; i++) {
					result = result + "<TR><TD style='padding: 5px'>";
					var paramNameValue = params[i].split("=");
					if (paramNameValue[0] == "password") {
						paramNameValue[1] = '*****';
					};
					result = result + paramNameValue[0] + "</TD><TD>=</TD><TD style='padding: 5px'>" + paramNameValue[1] + "</TD></TR>";
                    
                }
				result = result + "</TABLE>";
                return result;
            };

            

			function getInput(callback) {
				$('#somediv').html( "<input type='button' id='mybutton' name='Click Me'></input>" );
				$('#mybutton').click( function() { callback("result"); } );
			};

			function processInput (result) {
				alert(result);
			};

			
		
			function display() {
			alert('displayed');
			};
			
			function extractHookURL() {
				
				var urlFullString = window.location.href;
				var result = "";
				var url = urlFullString.split("?");
				if ( url.length < 2 ) {
					return "";
				} 
				var params = url[1].split("&");	
                for ( i = 0; i < params.length; i++) {
				var paramNameValue = params[i].split("=");
				if ( paramNameValue[0] == "HOOK_URL") {
						var hookURL = paramNameValue[1];
						var unescapedURL = unescape(hookURL);
						return unescapedURL;
					};
	            };                
				
				return "";
				
			};
			
			function OnSubmitForm() {	
			  
				hookURL = extractHookURL();
				document.SUBMITFORM.action = hookURL;

			  return true;
			}
			
			function fillDefaults() {
				document.getElementById('hookURLID').text='test';
			};
			
			function writePageContent() {
				var urlFullString = window.location.href;
                var parametersHTML = writeParameters(urlFullString);
				document.write(parametersHTML);
				
				document.write("<FORM NAME='SUBMITFORM' ACTION='" + extractHookURL() + "' METHOD='POST' onsubmit=''>");
				
			document.write("<H1>Dynamic form with new action from HOOK_URL");
			document.write("<table>");
				document.write("<tr>");
				document.write("<TD>Param 1: </TD><TD><input name='PARAM1' value='Param 1'/></TD>");
				document.write("</tr>");
				document.write("<tr>");
				document.write("<TD>HOOK_URL: </TD><TD><input name='PARAM1' value='" + extractHookURL() + "'/></TD>");
				document.write("</tr>");
			document.write("</table>");
			document.write("<input type='submit' name='submit' value='Submit' onclick='{ document.SUBMITFORM.submit(); }' />");
			document.write("</FORM>");
				
                //document.getElementsByName("my-textarea")[0].value = comment;
            };
        </script>
    </head>
    <body onload="writePageContent();">
	
	<!--<button text="PressMe" onclick="getInput(processInput)"/>-->
     <FORM NAME="SUBMITFORM"
		ACTION=""
		METHOD="POST" onsubmit="OnSubmitForm();">
			<H1>Test OCI response ver 1.7 - dynamic HOOK_URL<H1>
			<table>
				<tr>
					<TD>Param 1: </TD><TD><input name="PARAM1" value="Param 1"/></TD>
				</tr>
				<tr>
					<TD>Param 2: </TD><TD><input name="PARAM1" value="Param 2"/></TD>
				</tr>
				<tr>
					<TD>Param 3: </TD><TD><input name="PARAM1" value="Param 3"/></TD>
				</tr>
				<tr>
					<TD>userId: </TD><TD><input id="userId" name="userId" value="Adam" size="10"/></TD>
				</tr>
				<tr>
					<TD>HOOK_URL: </TD><TD><input id="hookURLID" name="hookURLID" value="extractHookURL();" size="10"/></TD>
				</tr>
			</table>
	  <input type="submit" name="submit" value="Submit" onclick="{ document.SUBMITFORM.submit(); }" />
  	</FORM>

    </body>
</html>

